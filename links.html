<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>

<style type="text/css" media="screen">
	body {
		margin: 0;
		cursor: crosshair;
	}
	#background {
		width: 768px; height: 1024px;
		background-repeat: no-repeat;
		background-image: url(screen.png);
	}
	div.link {
		position: absolute;
		background-color: white; opacity: .5;
		width: 200px; height: 100px;
		border: 1px solid red;
		font-family: Verdana;
		font-size: 8px;
	}
</style>

<head><title>Linker</title></head>
<body><div id="background"></div></body>
<form id="upform"><input id="upfile" type="file"></form>

<script type="text/javascript" charset="utf-8">

	window.moveTo(0, 0);
	window.resizeTo( 768 + 15, window.screen.availHeight );

	links_window = window.open(
		'blank.html', 'links_window',
		'location=0,status=0,scrollbars=0,width=400,height=600'
	);
  links_window.moveTo(769 + 15, 0);
	self.focus();

	var currentX = -1;
	var currentY = -1;
	var n_links = 0;

	$('body').click( function (e) {
		if ( currentX > 0 ) {
			$(this).append( $('<div id="link-' + ++n_links + '" class="link"></div>') );
			var dims = '{{' + currentX + ',' + currentY + '},{' + e.pageX + ',' + e.pageY + '}}';
			$('#link-' + n_links)
				.css( {
					left: currentX, top: currentY,
					width: e.pageX - currentX,
					height: e.pageY - currentY
				} )
				.append(dims);
			$(links_window.document.getElementById('links'))
				.append('<div contentEditable="true" id="link-' + n_links + '">' + dims + '</div>');
			currentX = currentY = -1;
		} else {
			currentX = e.pageX;
			currentY = e.pageY;
		}
	} ).on( 'click', 'div.link', function (e) {
		if ( e.altKey ) {
			$(links_window.document.getElementById(this.id)).remove();
			$(this).remove();
			e.stopPropagation();
		}
	} );

	$('#upfile').on( 'change', function (e) {
		var name = $('#upfile').val();
		$('#background').css( 'background-image', 'url(' + encodeURI(name) + ')' );
	} ).click( function (e) { e.stopPropagation() } );

</script>

